<p-card class="w-full max-w-4xl">
    <div class="flex flex-col">

        <div class="flex">
            <p-inputgroup>
                <p-inputgroup-addon>
                    <i class="pi pi-search"></i>
                </p-inputgroup-addon>
                <input class="w-full" pSize="small" [value]="fileService.query()" (input)="onInput(search.value)"
                    #search pInputText [placeholder]="'label.search'|translate" />
                <p-inputgroup-addon>
                    <p-button [disabled]="!fileService.query()" (onClick)="fileService.search('')" icon="pi pi-times"
                        severity="secondary" />
                </p-inputgroup-addon>

            </p-inputgroup>
            <p-button [pTooltip]="'label.refresh'|translate"
                [disabled]="!fileStore.files.value().items.length || fileService.isLoading()" [text]="true"
                icon="pi pi-refresh" (onClick)="fileService.refresh()" severity="secondary" />
        </div>
        <div class="w-full px-2 text-sm text-gray-400">
            {{'utils.pagination'|translate:{
            value: fileStore.files.value().items.length,
            total: fileStore.files.value().total,
            entity: 'label.plural.files'|translate
            } }}
        </div>
        <p-dataview [value]="fileStore.files.value().items">
            <ng-template #list let-items>
                @for(item of items; track item.id) {
                <div [routerLink]="[item.filename]" #rla="routerLinkActive" [queryParams]="{}"
                    [routerLinkActive]="'bg-highlight'" pRipple
                    class="flex hover:cursor-pointer items-center justify-between hover:bg-highlight hover:rounded-xl p-2">
                    <div class="flex flex-col p-menu-item-link gap-0 w-full justify-start items-start">
                        <div class="flex w-full items-center">
                            <span class="pi pi-file"></span>
                            <span class="ml-2">{{ item.filename }}</span>
                        </div>
                        @if(item.lastModified) {
                        <div class="text-gray-400 text-sm text-left">
                            {{item.lastModified | date:('date.datetime'|translate)}}
                        </div>
                        }
                    </div>
                    <p-button (onClick)="$event.stopPropagation(); op.toggle($event)" [text]="true"
                        icon="pi pi-ellipsis-v" />
                </div>
                <p-popover #op>
                    <div class="flex flex-col">
                        <p-button [label]="'action.edit'|translate" (onClick)="fileStore.editFile(item)" icon="pi pi-pencil"
                            [text]="true" />
                        <p-button [label]="'action.delete'|translate" (onClick)="fileStore.deleteFile($event,item.label)" icon="pi pi-trash"
                            [text]="true" />
                    </div>
                </p-popover>
                }
            </ng-template>
        </p-dataview>

        <p-divider class="mb-1" />
        <div class="flex px-2 w-full items-center">
            <p-fileupload [pTooltip]="'label.import'|translate" [auto]="true" [multiple]="true" mode="basic"
                [uploadButtonProps]="{label:''}" [chooseButtonProps]="{label:'',size:'large',text: true}"
                class="no-label" chooseIcon="pi pi-upload" name="import[]" accept="" maxFileSize="1000000"
                (onSelect)="onImport($event)" />
            <p-divider layout="vertical" />
            <p-button icon="pi pi-plus" class="w-full" styleClass="w-full" (onClick)="onCreateFile()"
                [label]="'utils.create.value'|translate:{value:'label.file.label'|translate}" severity="secondary"
                [text]="true" />
        </div>
    </div>
</p-card>