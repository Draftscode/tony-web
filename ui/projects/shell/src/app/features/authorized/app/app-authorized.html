<p-drawer (visibleChange)="settingsStore.toggle($event)" [visible]="settingsStore.isVisible()"
    [header]="'settings.menu.label'|translate" position="right">
    <app-settings />
</p-drawer>

@let menuMode = settingsStore.menuMode();
<app-main-menu [items]="menuItems()" [expandOnHover]="true" [isDragAndDropDisabled]="true" #mainMenu
    class="flex w-full h-full w-full bg-surface-50 dark:bg-surface-950" [mode]="menuMode">
    <ng-template #start>
        <div class="p-1 flex justify-between items-center w-full">
            <!-- @let firstImage = !mainMenu.isMouseOver() && menuMode === 'slim'; -->
            <!-- <img [src]="`${firstImage ?'images/logo/logo-plain.png':'images/logo/logo.png'}`"
                class="h-[40px] w-auto flex-none overflow-visible object-contain" /> -->
            <div class="h-[28px] items-center flex p-1 mt-2">
                <img [src]="'./images/logo-raw-no-text'+(settingsStore.isDark()?'-dark':'')+'.png'"
                    class="w-full max-w-[100px]" alt="Logo">
            </div>
            @if(mainMenu.isMouseOver() || menuMode === 'static') {
            <p-button (onClick)="settingsStore.toggleMenuMode()" size="small" [text]="true" [rounded]="true"
                [icon]="`pi pi-circle-${menuMode === 'slim'?'off':'on'}`" />
            }
        </div>
    </ng-template>
    <ng-template #end>
        <p-divider />
        <div class="w-full flex-col items-center justify-center flex mb-2 gap-2">
            <div (click)="openProfile()"
                [class]="`cursor-pointer hover:bg-highlight rounded w-full px-2 flex gap-1 items-center ${ mainMenu.isMouseOver() || menuMode !== 'slim' ? '':'justify-center'}`">
                <p-avatar [label]="avatarLabel()" shape="circle" />
                @if(mainMenu.isMouseOver() || menuMode !== 'slim') {
                <span>Hi</span>
                <span class="text-muted font-semibold">{{accountStore.me.value()?.username}}</span>
                }
            </div>
            @if(mainMenu.isMouseOver() || menuMode !== 'slim') {
            <p-button icon="pi pi-sign-out" styleClass="w-full" class="w-full" [label]="'label.logout'|translate"
                [text]="true" (onClick)="accountStore.logout()" />
            }
        </div>
    </ng-template>
    <ng-template #content>
        <div class="flex w-full h-full flex-col">
            <div class="flex w-full gap-1 justify-between p-2 items-center">
                <div class="flex gap-2 items-center">
                    @if(mainMenu.state() === 'collapsed') {
                    <p-button icon="pi pi-bars" severity="secondary" [outlined]="true" [rounded]="true"
                        (onClick)="mainMenu.toggle()" />
                    }
                    @if(!isVerySmall() && !isSmall()) {
                    <p-card class="p-0 rounded-full overflow-hidden shrink-0 items-center gap-1" [pt]="{body:'p-0'}">
                        <p-breadcrumb styleClass="px-3 py-2 text-sm" [model]="breadcrumbStore.pruned()"
                            [home]="breadcrumbStore.home()">
                            <ng-template #separator>|</ng-template>
                            <ng-template #item let-item>
                                <a class="cursor-pointer" [queryParams]="item.queryParams" [routerLink]="item.url">
                                    <i [class]="item.icon"></i>
                                    <span>{{item.label | translate}}</span>
                                </a>
                            </ng-template>
                        </p-breadcrumb>
                    </p-card>
                    }
                    @if(!isVerySmall()) {
                    <ng-container [ngTemplateOutlet]="searchTemplate" />
                    }
                </div>
                <div class="flex gap-2 items-center">
                    <p-button icon="pi pi-cog" severity="secondary" [outlined]="true" [rounded]="true"
                        (onClick)="settingsStore.toggle(true)" />
                </div>
            </div>
            <div class="min-h-0 flex flex-col overflow-auto p-2">
                <router-outlet />
            </div>
        </div>
    </ng-template>
</app-main-menu>


<p-toast />

<ng-template #searchTemplate>
    <p-iconfield>
        <p-inputicon class="pi pi-search" />
        <p-autocomplete #control optionValue="name" optionLabel="name" [completeOnFocus]="true"
            (onSelect)="selectItem($event.value)" inputStyleClass="rounded-full" size="small" [group]="true"
            [placeholder]="'label.search'|translate" (completeMethod)="query$.next($event.query)"
            [suggestions]="searchItems()">
            <ng-template let-item #item>
                <div class="flex h-[24px] items-center justify-between gap-2 w-full">
                    <div [innerHTML]="item.name" class="min-h-0 min-w-0 overflow-hidden max-w-[300px] text-ellipsis">
                    </div>
                    <p-button (onClick)="selectItem(item)" size="small" icon="pi pi-chevron-right" [text]="true" />
                </div>
            </ng-template>
            <ng-template let-group #group>
                <div class=" flex gap-2 items-center">
                    @let icon = group.label === 'offer'? 'briefcase' :group.label === 'ip.asset' ?
                    'shield': group.label === 'strategy'?'image' : group.label ===
                    'jurisdiction'?'flag':group.label ==='options'?'address-book':'th-large';
                    <i [class]="`pi pi-${icon}`"></i>
                    <span>{{ `group.${group.label}.label`|translate }}</span>
                </div>
            </ng-template>
        </p-autocomplete>
    </p-iconfield>
</ng-template>